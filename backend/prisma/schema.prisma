generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Sistema {
  id      Int     @id @default(autoincrement())
  nome    String  @unique
  logoUrl String?
  ativo   Boolean @default(true)

  // Relacionamento muitos-para-muitos com ERPs
  erps Erp[] @relation("SistemaErps")
}

model Erp {
  id    Int     @id @default(autoincrement())
  nome  String  @unique
  ativo Boolean @default(true)

  // Relacionamento muitos-para-muitos com Sistemas
  sistemas Sistema[] @relation("SistemaErps")

  // Relacionamento com DocumentaÃ§Ãµes e ServiÃ§os
  documentacoes Documentacao[] // RELACIONAMENTO INVERSO
  servicos      Servico[]
}

model Documentacao {
  id               Int      @id @default(autoincrement())
  nome_empresa     String // O nome da empresa serÃ¡ armazenado diretamente
  nome_contratante String
  documentado_por  String
  data             DateTime
  numero_contrato  String?
  info_adicionais  String?
  createdAt        DateTime @default(now())

  // RELACIONAMENTO COM ERP 
  erpId Int?
  erp   Erp? @relation(fields: [erpId], references: [id])

  servicos          Servico[]
  servicosDesejados ServicoDesejado[]
}

model Servico {
  id                  Int      @id @default(autoincrement())

  // ðŸ”— Nome do serviÃ§o (catÃ¡logo)
  nomeServicoId Int
  nomeServico   NomeServico @relation(fields: [nomeServicoId], references: [id])

  // ðŸ“„ Dados do serviÃ§o
  descricao           String?
  instrucoes          String?
  ativo               Boolean  @default(true)
  sem_necessidade_api Boolean  @default(false)
  endpoint            String?
  parametros_padrao   Json?
  exige_contrato      Boolean  @default(false)
  exige_cpf_cnpj      Boolean  @default(false)
  exige_login_ativo   Boolean  @default(false)
  responsavel_padrao  String?
  createdAt           DateTime @default(now())

  // ðŸ”— DocumentaÃ§Ã£o
  documentacaoId Int
  documentacao   Documentacao @relation(fields: [documentacaoId], references: [id])

  // ðŸ”— ERP
  erpId Int
  erp   Erp @relation(fields: [erpId], references: [id])
}

model ServicoDesejado {
  id        Int      @id @default(autoincrement())
  descricao String?
  createdAt DateTime @default(now())

  documentacaoId Int
  documentacao   Documentacao @relation(fields: [documentacaoId], references: [id])
}

model NomeServico {
  id Int @id @default(autoincrement())
  nome String @unique

  servicos Servico[]
}
