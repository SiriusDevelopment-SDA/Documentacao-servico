generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Sistema {
  id      Int     @id @default(autoincrement())
  nome    String  @unique
  ativo   Boolean @default(true)
  logoUrl String?
  erps    Erp[]   @relation("SistemaErps")
}

model Erp {
  id                    Int                   @id @default(autoincrement())
  nome                  String                @unique
  ativo                 Boolean               @default(true)
  documentacoes         Documentacao[]
  empresas              Empresa[]
  parametrosNecessarios ParametroNecessario[]
  parametrosPadrao      ParametroPadrao[]
  regras                RegraNegocio[]
  servicos              Servico[]
  sistemas              Sistema[]             @relation("SistemaErps")
}

model Documentacao {
  id                Int               @id @default(autoincrement())
  nome_empresa      String
  nome_contratante  String
  documentado_por   String
  data              DateTime
  numero_contrato   String?
  info_adicionais   String?
  createdAt         DateTime          @default(now())
  erpId             Int?
  erp               Erp?              @relation(fields: [erpId], references: [id])
  servicos          Servico[]
  servicosDesejados ServicoDesejado[]
}

model Servico {
  id                  Int          @id @default(autoincrement())
  descricao           String?
  instrucoes          String?
  ativo               Boolean      @default(true)
  sem_necessidade_api Boolean      @default(false)
  endpoint            String?
  parametros_padrao   Json?
  exige_contrato      Boolean      @default(false)
  exige_cpf_cnpj      Boolean      @default(false)
  exige_login_ativo   Boolean      @default(false)
  responsavel_padrao  String?
  createdAt           DateTime     @default(now())
  documentacaoId      Int
  erpId               Int
  nomeServicoId       Int
  dataDesativacao     DateTime?
  motivoDesativacao   String?
  documentacao        Documentacao @relation(fields: [documentacaoId], references: [id])
  erp                 Erp          @relation(fields: [erpId], references: [id])
  nomeServico         NomeServico  @relation(fields: [nomeServicoId], references: [id])
}

model ServicoDesejado {
  id             Int          @id @default(autoincrement())
  descricao      String?
  createdAt      DateTime     @default(now())
  documentacaoId Int
  documentacao   Documentacao @relation(fields: [documentacaoId], references: [id])
}

model NomeServico {
  id       Int       @id @default(autoincrement())
  nome     String    @unique
  servicos Servico[]
}

model Empresa {
  id       Int            @id @default(autoincrement())
  nome     String         @unique
  cpf_cnpj String?        @unique
  erpId    Int
  erp      Erp            @relation(fields: [erpId], references: [id])
  regras   EmpresaRegra[]
}

model ParametroPadrao {
  id                    Int                                  @id @default(autoincrement())
  nome                  String
  ativo                 Boolean                              @default(true)
  erpId                 Int
  erp                   Erp                                  @relation(fields: [erpId], references: [id])
  parametrosNecessarios ParametroPadraoParametroNecessario[]
  setores               SetorParametroPadrao[]

  @@unique([nome, erpId])
}

model ParametroNecessario {
  id               Int                                  @id @default(autoincrement())
  nome             String
  ativo            Boolean                              @default(true)
  erpId            Int
  erp              Erp                                  @relation(fields: [erpId], references: [id])
  parametrosPadrao ParametroPadraoParametroNecessario[]
  setores          SetorParametroNecessario[]

  @@unique([nome, erpId])
}

model ParametroPadraoParametroNecessario {
  id                    Int                 @id @default(autoincrement())
  parametroPadraoId     Int
  parametroNecessarioId Int
  obrigatorio           Boolean             @default(true)
  ordem                 Int?
  parametroNecessario   ParametroNecessario @relation(fields: [parametroNecessarioId], references: [id])
  parametroPadrao       ParametroPadrao     @relation(fields: [parametroPadraoId], references: [id])

  @@unique([parametroPadraoId, parametroNecessarioId])
}

model RegraNegocio {
  id                Int           @id @default(autoincrement())
  descricao         String
  ativa             Boolean       @default(true)
  erpId             Int
  createdAt         DateTime      @default(now())
  erp               Erp           @relation(fields: [erpId], references: [id])
  setores           RegraSetor[]
  empresas          EmpresaRegra[]
}

model RegraSetor {
  id        Int                     @id @default(autoincrement())
  regraId   Int
  regra     RegraNegocio            @relation(fields: [regraId], references: [id])
  nome      String                  // mock vindo do front
  padroes   SetorParametroPadrao[]
  necessarios SetorParametroNecessario[]
}

model SetorParametroPadrao {
  id        Int               @id @default(autoincrement())
  setorId   Int
  padraoId  Int
  setor     RegraSetor        @relation(fields: [setorId], references: [id])
  padrao    ParametroPadrao   @relation(fields: [padraoId], references: [id])
}

model SetorParametroNecessario {
  id          Int                 @id @default(autoincrement())
  setorId     Int
  necessarioId Int
  setor       RegraSetor          @relation(fields: [setorId], references: [id])
  necessario  ParametroNecessario @relation(fields: [necessarioId], references: [id])
}

model EmpresaRegra {
  id        Int          @id @default(autoincrement())
  empresaId Int
  regraId   Int
  ativa     Boolean      @default(true)
  empresa   Empresa      @relation(fields: [empresaId], references: [id])
  regra     RegraNegocio @relation(fields: [regraId], references: [id])

  @@unique([empresaId, regraId])
}
